name: Test PR Creation

on:
  workflow_dispatch:
    inputs:
      pr_title:
        description: "Title for the test PR"
        required: false
        default: "Test PR from Rovo Dev"
      base_branch:
        description: "Base branch for the PR (leave empty for current branch)"
        required: false
        default: ""

jobs:
  test-pr-creation:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Rovo Dev with PR Creation
        id: rovo-dev
        uses: ./
        with:
          prompt: |
            Create a simple test file called 'test-pr-output.md' with the following content:
            
            # Test PR Created by Rovo Dev
            
            This file was created automatically to test PR creation functionality.
            
            - Timestamp: $(date)
            - Workflow Run: ${{ github.run_id }}
            - Actor: ${{ github.actor }}
          atlassian_email: ${{ secrets.ATLASSIAN_EMAIL }}
          atlassian_token: ${{ secrets.ATLASSIAN_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          create_pr: "true"
          pr_title: ${{ inputs.pr_title }}
          pr_body: |
            ## Test PR
            
            This PR was created automatically to test the PR creation functionality of the Rovo Dev GitHub Action.
            
            **Workflow Run:** ${{ github.run_id }}
            **Triggered by:** ${{ github.actor }}
            
            ---
            _This PR can be safely closed without merging._
          pr_base_branch: ${{ inputs.base_branch }}

      - name: Output Results
        run: |
          echo "Exit Code: ${{ steps.rovo-dev.outputs.exit_code }}"
          echo "PR Created: ${{ steps.rovo-dev.outputs.pr_created }}"
          echo "PR URL: ${{ steps.rovo-dev.outputs.pr_url }}"
          echo "Branch Name: ${{ steps.rovo-dev.outputs.branch_name }}"
