name: Update README

on:
  push:
    branches:
      - main
    paths:
      - "action.yml"

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update README with Rovo Dev
        id: rovo-dev
        uses: ./
        with:
          prompt: |
            Read the action.yml file to understand all the inputs and outputs of this GitHub Action.

            Then, update the README.md file to ensure the documentation is in sync with action.yml:

            1. Update the "Inputs" table to include ALL inputs defined in action.yml with their descriptions, required status, and default values
            2. Update the "Outputs" table to include ALL outputs defined in action.yml with their descriptions
            3. Update the "Features" section to mention any key capability that's not already present

            Make sure to preserve the existing structure and formatting of the README.md file.
            Only make changes that are necessary to sync the documentation with action.yml.
            No need to add examples.
          atlassian_email: ${{ secrets.ATLASSIAN_EMAIL }}
          atlassian_token: ${{ secrets.ATLASSIAN_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          create_pr: "true"
          pr_title: "docs: Update README.md to sync with action.yml"
          pr_body: |
            ## Automated Documentation Update

            This PR was automatically generated to keep README.md in sync with action.yml.

            **Triggered by:** Commit to main branch that modified action.yml
            **Workflow Run:** ${{ github.run_id }}

            Please review the changes to ensure the documentation accurately reflects the action's capabilities.
          pr_base_branch: main
          branch_prefix: docs/readme-sync

      - name: Output Results
        run: |
          echo "Exit Code: ${{ steps.rovo-dev.outputs.exit_code }}"
          echo "PR Created: ${{ steps.rovo-dev.outputs.pr_created }}"
          echo "PR URL: ${{ steps.rovo-dev.outputs.pr_url }}"
          echo "Branch Name: ${{ steps.rovo-dev.outputs.branch_name }}"
